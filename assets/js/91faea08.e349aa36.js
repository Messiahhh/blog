"use strict";(self.webpackChunkakara=self.webpackChunkakara||[]).push([[7971],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),p=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(i.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(t),m=a,k=d["".concat(i,".").concat(m)]||d[m]||u[m]||l;return t?r.createElement(k,s(s({ref:n},c),{},{components:t})):r.createElement(k,s({ref:n},c))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,s=new Array(l);s[0]=m;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o[d]="string"==typeof e?e:a,s[1]=o;for(var p=2;p<l;p++)s[p]=t[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5979:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var r=t(7462),a=(t(7294),t(3905));const l={},s="\u5185\u7f6e\u6a21\u5757",o={unversionedId:"node/build-in-modules",id:"node/build-in-modules",title:"\u5185\u7f6e\u6a21\u5757",description:"http\u6a21\u5757",source:"@site/docs/node/build-in-modules.md",sourceDirName:"node",slug:"/node/build-in-modules",permalink:"/blog/docs/node/build-in-modules",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/node/build-in-modules.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u4e8c\u8fdb\u5236\u4e0e\u7f16\u7801",permalink:"/blog/docs/node/stream"},next:{title:"\u7b2c\u4e09\u65b9\u5e93",permalink:"/blog/docs/node/library"}},i={},p=[{value:"http\u6a21\u5757",id:"http\u6a21\u5757",level:2},{value:"\u9759\u6001\u76ee\u5f55",id:"\u9759\u6001\u76ee\u5f55",level:3},{value:"\u5904\u7406Post\u8bf7\u6c42",id:"\u5904\u7406post\u8bf7\u6c42",level:3},{value:"fs\u6a21\u5757",id:"fs\u6a21\u5757",level:2},{value:"<code>readFile</code>",id:"readfile",level:3},{value:"<code>writeFile</code>",id:"writefile",level:3},{value:"<code>createReadStream</code>",id:"createreadstream",level:3},{value:"<code>createWriteStream</code>",id:"createwritestream",level:3},{value:"path\u6a21\u5757",id:"path\u6a21\u5757",level:2},{value:"<code>__dirname</code>",id:"__dirname",level:3},{value:"<code>path.resolve</code>",id:"pathresolve",level:3},{value:"<code>require.resolve</code>",id:"requireresolve",level:3},{value:"<code>path.join</code>",id:"pathjoin",level:3},{value:"process\u6a21\u5757",id:"process\u6a21\u5757",level:2},{value:"<code>process.cwd()</code>",id:"processcwd",level:3},{value:"<code>process.argv</code>",id:"processargv",level:3},{value:"<code>process.env</code>",id:"processenv",level:3},{value:"cross-env",id:"cross-env",level:4},{value:"dotenv",id:"dotenv",level:4},{value:"<code>process.stdin</code>",id:"processstdin",level:3},{value:"<code>process.stdout</code>",id:"processstdout",level:3},{value:"util\u6a21\u5757",id:"util\u6a21\u5757",level:2},{value:"<code>deprecate</code>",id:"deprecate",level:3},{value:"<code>promisify</code>",id:"promisify",level:3},{value:"child_process\u6a21\u5757",id:"child_process\u6a21\u5757",level:2},{value:"<code>fork</code>",id:"fork",level:3},{value:"<code>exec</code>",id:"exec",level:3},{value:"<code>execFile</code>",id:"execfile",level:3},{value:"<code>spawn</code>",id:"spawn",level:3},{value:"cluster\u6a21\u5757",id:"cluster\u6a21\u5757",level:2},{value:"url\u6a21\u5757",id:"url\u6a21\u5757",level:2},{value:"querystring\u6a21\u5757",id:"querystring\u6a21\u5757",level:2},{value:"os\u6a21\u5757",id:"os\u6a21\u5757",level:2},{value:"event\u6a21\u5757",id:"event\u6a21\u5757",level:2}],c={toc:p},d="wrapper";function u(e){let{components:n,...t}=e;return(0,a.kt)(d,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u5185\u7f6e\u6a21\u5757"},"\u5185\u7f6e\u6a21\u5757"),(0,a.kt)("h2",{id:"http\u6a21\u5757"},"http\u6a21\u5757"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const http = require('http')\nconst server = http.createServer((req, res) => {\n    console.log(req.url) // \u8bf7\u6c42url\n    console.log(req.method) // \u8bf7\u6c42\u65b9\u6cd5\n    console.log(req.headers) // \u8bf7\u6c42\u5934\u90e8\n\n    if (req.url === '/') {\n        // \u8bbe\u7f6e\u54cd\u5e94\u7684\u72b6\u6001\u7801\u548c\u5934\u90e8\n        res.writeHead(200, {'Content-Type': 'text/plain; charset=utf-8'})\n\n        // \u5355\u72ec\u8bbe\u7f6e\u72b6\u6001\u7801\n        res.statusCode = 200\n        // \u5355\u72ec\u8bbe\u7f6e\u54cd\u5e94\u5934\u90e8\n        res.setHeader('Content-Type', 'text/plain; charset=utf-8')\n        // Set-Cookie\n        res.setHeader('Set-Cookie', 'name=akara; secure')\n\n        // \u8bbe\u7f6e\u54cd\u5e94\u5b9e\u4f53\n        res.write(\"hello world\")\n        res.write(\"!!!\")\n        // \u53d1\u9001\u54cd\u5e94\u62a5\u6587\n        res.end()\n    }\n\n})\n\nserver.listen(3000, () => {\n    console.log(\"\u670d\u52a1\u5668\u8dd1\u57283000\u7aef\u53e3\")\n})\n")),(0,a.kt)("h3",{id:"\u9759\u6001\u76ee\u5f55"},"\u9759\u6001\u76ee\u5f55"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const http = require('http')\nconst server = http.createServer((req, res) => {\n    if (req.url === '/') {\n        // ...\n    }\n    else {\n        let filePath = path.join(__dirname, 'static', url.pathname)\n        try {\n            let file = await fs.readFileAsync(filePath)\n            res.statusCode = 200\n            res.end(file)\n        } catch (error) {\n            res.statusCode = 404\n            res.end(\"404 Not Found\")\n        }\n    }\n    // \u6216\u8005\n    else {\n        let fileName = url.pathname\n        let type\n        switch(fileName.substr(fileName.lastIndexOf('.') + 1)) {\n            case 'css':\n                type = 'text/css; charset=utf-8'\n                break\n            case 'js':\n                type = 'applaction/javascript; charset=utf-8'\n                break\n            // other situations \n            default:\n                type = 'application/octet-stream'\n                break\n        }\n        try {\n            let file = await fs.readFileAsync(`./static${url.pathname}`)\n            res.writeHead(200, {'Content-Type': type})\n            res.end(file)\n        } catch (error) {\n            res.writeHead(400, {'Content-Type': 'text/plain; charset=utf-8'})\n            res.end(\"404\u9519\u8bef\u5566\uff01\")\n        }\n    }\n}).listen(3000)\n\n\n")),(0,a.kt)("h3",{id:"\u5904\u7406post\u8bf7\u6c42"},"\u5904\u7406Post\u8bf7\u6c42"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u524d\u7aef (\u7701\u7565\u90e8\u5206\u4ee3\u7801)\nlet type = typeof data\nlet header\nif (type === 'string') {\n    header = 'application/x-www-form-urlencoded'\n}\nelse if (data instanceof File || data instanceof FormData) {\n    header = 'multipart/form-data; boundary=---xxxxxxxxxxxx'\n}\nelse {\n    header = 'application/json'\n    data = JSON.stringify(data)\n}\nxhr.setRequestHeader('Content-type', header)\nxhr.send(data)\n\n\n// \u540e\u7aef\nconst http = require('http')\nconst fs = require('fs')\nconst server = http.createServer((req, res) => {\n    if (req.url === '/upload') {\n\n        let segment = []\n\n        req.on('data', (chunk) => {\n            // chunk\u4e3aBuffer\u5bf9\u8c61\n            // \u5b57\u7b26\u4e32aaa=bbb\u5bf9\u5e94\u7684Buffer\u5bf9\u8c61\u5982\u4e0b\n            // <Buffer 61 61 61 3d 62 62 62>\n            segment.push(chunk)\n        })\n\n        req.on('end', () => {\n            // \u6587\u4ef6\u4e0a\u4f20\u4ee3\u7801\n            segment = Buffer.concat(segment)\n            // \u4e0b\u65b9\u4ee3\u7801\u83b7\u53d6buffer\u8f6c\u6210\u7684\u5b57\u7b26\u4e32\n            // segment = Buffer.concat(segment).toString()\n            fs.writeFile('fileName', segment, (err) => {\n                res.writeHead(200, {'Content-Type': 'text/plain; charset=utf-8'})\n                res.write(\"\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\uff01\")\n                res.end()\n            })\n        })\n    }\n})\n\nserver.listen(3000, () => {\n    console.log(\"\u670d\u52a1\u5668\u8dd1\u57283000\u7aef\u53e3\")\n})\n")),(0,a.kt)("h2",{id:"fs\u6a21\u5757"},"fs\u6a21\u5757"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const fs = require('fs')\n")),(0,a.kt)("h3",{id:"readfile"},(0,a.kt)("inlineCode",{parentName:"h3"},"readFile")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"fs.readFile('./image.png', (err, buffer) => {\n    if (err) throw err\n})\n")),(0,a.kt)("h3",{id:"writefile"},(0,a.kt)("inlineCode",{parentName:"h3"},"writeFile")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u5199\u5165\u6587\u672c\nfs.writeFile('index.txt', 'hello world', 'utf8')\n// \u5199\u5165buffer\nfs.writeFile('image.png', buffer)\n")),(0,a.kt)("h3",{id:"createreadstream"},(0,a.kt)("inlineCode",{parentName:"h3"},"createReadStream")),(0,a.kt)("h3",{id:"createwritestream"},(0,a.kt)("inlineCode",{parentName:"h3"},"createWriteStream")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const reader = fs.createReadStream(data.path)\nconst stream = fs.createWriteStream(`./image/${Math.floor(Math.random() * 10000)}.jpg`)\nreader.pipe(stream)\n")),(0,a.kt)("h2",{id:"path\u6a21\u5757"},"path\u6a21\u5757"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const path = require('path')\n")),(0,a.kt)("h3",{id:"__dirname"},(0,a.kt)("inlineCode",{parentName:"h3"},"__dirname")),(0,a.kt)("p",null,"\u8fd4\u56de\u5f53\u524d\u6587\u4ef6\u6240\u5728\u7684",(0,a.kt)("strong",{parentName:"p"},"\u7edd\u5bf9\u8def\u5f84")),(0,a.kt)("h3",{id:"pathresolve"},(0,a.kt)("inlineCode",{parentName:"h3"},"path.resolve")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const url = path.resolve('./static')\n// \u7b49\u4ef7\u4e8e\nconst url = path.join(process.cwd(), './static')\n")),(0,a.kt)("p",null,"\u6839\u636e\u5f53\u524d\u6240\u5728\u76ee\u5f55\uff0c\u5373",(0,a.kt)("inlineCode",{parentName:"p"},"process.cwd()"),"\u548c\u4f20\u5165\u7684\u8def\u5f84\u53c2\u6570\uff0c\u89e3\u6790\u51fa\u5b8c\u6574\u7684",(0,a.kt)("strong",{parentName:"p"},"\u7edd\u5bf9\u8def\u5f84")),(0,a.kt)("h3",{id:"requireresolve"},(0,a.kt)("inlineCode",{parentName:"h3"},"require.resolve")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u4f5c\u4e3a\u62d3\u5c55\u9605\u8bfb")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const url = require.resolve('webpack') // /path/to/project/node_modules/webpack/lib/index.js\n")),(0,a.kt)("h3",{id:"pathjoin"},(0,a.kt)("inlineCode",{parentName:"h3"},"path.join")),(0,a.kt)("p",null,"\u7528\u6765\u62fc\u63a5\u4f20\u5165\u7684\u53c2\u6570\u5f97\u5230\u4e00\u4e2a",(0,a.kt)("strong",{parentName:"p"},"\u76f8\u5bf9\u8def\u5f84"),"\uff0c\u5b83\u7684\u597d\u5904\u662f\u53ef\u4ee5\u62b9\u5e73\u4e0d\u540c\u5e73\u53f0\u7684\u5206\u5272\u7b26\u53f7\u7684\u5dee\u5f02\uff08\u5982Linux\u73af\u5883\u4e0b\u5206\u9694\u7b26\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"/"),"\uff0c\u800cWindows\u73af\u5883\u4e0b\u5206\u9694\u7b26\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"\\"),"\uff09"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const path1 = path.join('a', 'b') // 'a/b'\nconst path2 = path.join('a', 'b', '../c') // 'a/c'\nconst path3 = path.join(__dirname, '..', 'b') \n")),(0,a.kt)("h2",{id:"process\u6a21\u5757"},"process\u6a21\u5757"),(0,a.kt)("h3",{id:"processcwd"},(0,a.kt)("inlineCode",{parentName:"h3"},"process.cwd()")),(0,a.kt)("p",null,"\u83b7\u5f97\u6267\u884c\u811a\u672c\u65f6\u6240\u5904\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u5f53\u6211\u4eec\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"fs.readFile"),"\u7b49\u51fd\u6570\u5e76\u4f20\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"./index.html"),"\u5f62\u5f0f\u7684\u76f8\u5bf9\u8def\u5f84\u65f6\uff0c\u76f8\u5bf9\u8def\u5f84\u5b9e\u9645\u4e0a\u662f\u76f8\u5bf9\u4e8e\u6267\u884c\u811a\u672c\u65f6\u6240\u5728\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u76f8\u5bf9\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"process.cwd()"),"\u3002"),(0,a.kt)("p",null,"\u56e0\u6b64\u6839\u636e\u6267\u884c\u811a\u672c\u65f6\u6240\u5904\u8def\u5f84\u7684\u4e0d\u540c\uff0c\u7ed3\u679c\u4e5f\u53ef\u80fd\u6709\u5f88\u5927\u7684\u5dee\u5f02\uff0c\u6240\u4ee5\u5f88\u591a\u65f6\u5019\u6211\u4eec\u4f1a\u4f20\u5165\u7edd\u5bf9\u8def\u5f84\uff0c\u5982"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"fs.readFile(`${__dirname}/../index.html`)\nfs.readFile(path.join(__dirname, '../index.html'))\n")),(0,a.kt)("h3",{id:"processargv"},(0,a.kt)("inlineCode",{parentName:"h3"},"process.argv")),(0,a.kt)("p",null,"\u83b7\u53d6\u6267\u884c\u811a\u672c\u65f6\u547d\u4ee4\u884c\u8f93\u5165\u7684\u53c2\u6570"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"$node index.js abc\n[\n    'node',\n    'index.js',\n    'abc'\n] // process.argv\n")),(0,a.kt)("h3",{id:"processenv"},(0,a.kt)("inlineCode",{parentName:"h3"},"process.env")),(0,a.kt)("p",null,"\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"Node"),"\u4e2d\u53ef\u4ee5\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"process.env"),"\u62ff\u5230\u73af\u5883\u53d8\u91cf\uff0c\u4ece\u800c\u6839\u636e\u4e0d\u540c\u7684\u73af\u5883\u6267\u884c\u4e0d\u540c\u7684\u4ee3\u7801\u3002"),(0,a.kt)("h4",{id:"cross-env"},"cross-env"),(0,a.kt)("p",null,"\u901a\u5e38\u4e0d\u540c\u7cfb\u7edf\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u4e3a\u6b64\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93 ",(0,a.kt)("inlineCode",{parentName:"p"},"cross-env"),"\u6765\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'// package.json\n{\n    "script": {\n        "start": "cross-env NODE_ENV=development node app.js"\n    }\n}\n')),(0,a.kt)("h4",{id:"dotenv"},"dotenv"),(0,a.kt)("p",null,"\u9664\u4e86\u5728\u547d\u4ee4\u884c\u4e2d\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5355\u72ec\u7684\u6587\u4ef6 ",(0,a.kt)("inlineCode",{parentName:"p"},".env"),"\u6765\u4fdd\u5b58\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u642d\u914d ",(0,a.kt)("inlineCode",{parentName:"p"},"dotenv"),"\u5e93\u6765\u8bfb\u53d6 ",(0,a.kt)("inlineCode",{parentName:"p"},".env"),"\u6587\u4ef6\u4e2d\u7684\u73af\u5883\u53d8\u91cf\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-.env"},"NODE_ENV=development\nname=aka\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app.js\nconst dotenv = require('dotenv')\ndotenv.config() // \u8bfb\u53d6.env\u6587\u4ef6\u4e2d\u7684\u4fe1\u606f\n\nconsole.log(process.env.NODE_ENV)\n")),(0,a.kt)("p",null,"\u6216\u8005\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"config.js")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// config.js\nconst dotenv = require('dotenv')\ndotenv.config()\n\nmodule.exports = {\n    NODE_ENV: process.env.NODE_ENV,\n    name: process.env.name\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app.js\nconst { NODE_ENV, name } = require('./config.js')\nconsole.log(NODE_ENV, name)\n")),(0,a.kt)("h3",{id:"processstdin"},(0,a.kt)("inlineCode",{parentName:"h3"},"process.stdin")),(0,a.kt)("p",null,"\u6807\u51c6\u8f93\u5165\u6d41"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"process.stdin.on('data', (chunk) => {\n    process.stdout.write('Hello' + chunk)\n    process.exit()\n})\n")),(0,a.kt)("h3",{id:"processstdout"},(0,a.kt)("inlineCode",{parentName:"h3"},"process.stdout")),(0,a.kt)("p",null,"\u6807\u51c6\u8f93\u51fa\u6d41"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"process.stdout.write('Hello world')\n")),(0,a.kt)("h3",{id:""}),(0,a.kt)("h2",{id:"util\u6a21\u5757"},"util\u6a21\u5757"),(0,a.kt)("p",null,"\u8fd9\u4e2a\u6a21\u5757\u63d0\u4f9b\u4e86\u8bf8\u591a\u5f88\u6709\u7528\u7684\u5c0f\u5de5\u5177\u3002"),(0,a.kt)("h3",{id:"deprecate"},(0,a.kt)("inlineCode",{parentName:"h3"},"deprecate")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const util = require('util')\nfunction A() {\n    console.log('aaa');\n}\n\nmodule.exports = util.deprecate(A, 'A() is deprecated. Use B() instead.')\n")),(0,a.kt)("h3",{id:"promisify"},(0,a.kt)("inlineCode",{parentName:"h3"},"promisify")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const util = require('util')\nconst fs = require('fs')\nconst readFile = util.promisify(fs.readFile)\n\nasync function A() {\n    const data = await readFile('./index.html') \n}\n")),(0,a.kt)("h2",{id:"child_process\u6a21\u5757"},"child_process\u6a21\u5757"),(0,a.kt)("p",null,"Node\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"child_process"),"\u6a21\u5757\u63d0\u4f9b\u4e86\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u56db\u79cd\u65b9\u5f0f\uff0c\u5206\u522b\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"folk"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"exec"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"execFile"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"spawn"),"\u3002"),(0,a.kt)("p",null,"\u5176\u4e2d\uff0c\u53ea\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"fork"),"\u662f\u7528\u6765\u521b\u5efaNode\u7a0b\u5e8f\u7684\u5b50\u8fdb\u7a0b\uff0c\u5176\u4ed6\u4e09\u79cd\u53ef\u4ee5\u7528\u6765\u521b\u5efa ",(0,a.kt)("inlineCode",{parentName:"p"},"shell"),"\u5b50\u8fdb\u7a0b\u3002"),(0,a.kt)("h3",{id:"fork"},(0,a.kt)("inlineCode",{parentName:"h3"},"fork")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// parent.js\nconst cp = require('child_process')\nconst path = require('path')\nconst child = cp.fork('./child.js')\n\nchild.on('message', (msg) => { // \u8fdb\u7a0b\u901a\u4fe1\n    console.log(msg);\n    child.disconnect()\n})\nchild.send('hello')\n\n// child.js\nprocess.on('message', (msg) => {\n    console.log(msg);\n    process.send('akara')\n})\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"exec"),"\u53ef\u4ee5\u76f4\u63a5\u5728Node\u4ee3\u7801\u4e2d\u5199\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"shell"),"\u547d\u4ee4\uff0c\u5e76\u4e14\u5728\u6267\u884c\u4e00\u4e9b\u5371\u9669\u7684\u811a\u672c\uff08\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"rm / -rf"),"\uff09\u662f\u4e0d\u4f1a\u63d0\u793a\u7684\uff1b\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"execFile"),"\u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"spawn"),"\u7684\u53c2\u6570\u90fd\u662f\u6587\u4ef6\u7684\u540d\u5b57\uff0c\u5e76\u4e14 ",(0,a.kt)("inlineCode",{parentName:"p"},"execFile"),"\u5728\u6267\u884c\u5371\u9669\u64cd\u4f5c\u65f6\u4f1a\u7206\u51fa\u5f02\u5e38\uff0c\u56e0\u6b64\u66f4\u52a0\u7684\u5b89\u5168\u3002"),(0,a.kt)("h3",{id:"exec"},(0,a.kt)("inlineCode",{parentName:"h3"},"exec")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const exec = util.promisify(cp.exec)\n\n(async function () {\n  const res = await exec(cat ${file})\n  console.log(res.stdout);\n})()\n")),(0,a.kt)("h3",{id:"execfile"},(0,a.kt)("inlineCode",{parentName:"h3"},"execFile")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const exec = util.promisify(cp.execFile)\n\n(async function () {\n    const res = await exec('cat', [file])\n    console.log(res.stdout);\n})()\n")),(0,a.kt)("h3",{id:"spawn"},(0,a.kt)("inlineCode",{parentName:"h3"},"spawn")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"spawn"),"\u7684\u7279\u70b9\u662f\u57fa\u4e8e\u6d41\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"pipe"),"\u663e\u5f97\u66f4\u52a0\u7075\u6d3b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const cat = cp.spawn('cat', [file])\nconst sort = cp.spawn('sort')\n\ncat.stdout.pipe(sort.stdin)\nsort.stdout.pipe(process.stdout)\n")),(0,a.kt)("h2",{id:"cluster\u6a21\u5757"},"cluster\u6a21\u5757"),(0,a.kt)("p",null,"\u4f7f\u7528cluster\u6765\u642d\u5efa\u96c6\u7fa4node\u5e94\u7528"),(0,a.kt)("p",null,"\u600e\u4e48\u8bb2\u5462\uff0c\u76f4\u63a5\u770b\u7f51\u4e0a\u7684\u4ee3\u7801\u5427\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"var cluster = require('cluster');\nvar http = require('http');\nvar numCPUs = require('os').cpus().length; // \u83b7\u53d6CPU\u7684\u4e2a\u6570\n\nif (cluster.isMaster) {\n  for (var i = 0; i < numCPUs; i++) {\n    cluster.fork();\n }\n\n  cluster.on('exit', function(worker, code, signal) {\n    console.log('worker ' + worker.process.pid + ' died');\n });\n} else {\n  http.createServer(function(req, res) {\n    res.writeHead(200);\n    res.end(\"hello world\\n\");\n }).listen(8000);\n}\n\n")),(0,a.kt)("p",null,"\u4ee5\u4e0a\u4ee3\u7801\uff0c\u7236\u8fdb\u7a0b\u6839\u636eCPU\u7684\u6570\u91cf\u521b\u5efa\u5b50\u8fdb\u7a0b\u3002\u53ea\u770b\u4ee3\u7801\u7684\u8bdd\uff0c\u5bb9\u6613\u7406\u89e3\u6210\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u521b\u5efa\u4e86\u4e00\u4e2aserver\u6765\u76d1\u542c8000\u7aef\u53e3\uff0c\u4f46\u8fd9\u662f\u4e0d\u5207\u5b9e\u9645\u7684\u3002\u5176\u5b9ecluster\u505a\u4e86\u5f88\u591a\u4e8b\u60c5\uff0c\u5728\u5b9e\u9645\u7684\u60c5\u51b5\u4e0b\uff0c\u7236\u8fdb\u7a0b\u4f1a\u521b\u5efaserver\u76d1\u542c\u7aef\u53e3\uff0c\u6536\u5230\u7684\u8bf7\u6c42\u4f1a\u5206\u53d1\u7ed9\u4e0d\u540c\u7684\u8fdb\u7a0b\u53bb\u5904\u7406\u3002"),(0,a.kt)("p",null,"cluster\u8ba9\u6211\u4eec\u4e0d\u7528\u4eb2\u81ea\u53bb\u7ba1\u7406\u8fdb\u7a0b\u901a\u4fe1\u7684\u4e8b\u60c5\uff08process.on('message')\uff09\uff0c\u800c\u4e14\u4e5f\u81ea\u5e26\u8d1f\u8f7d\u5747\u8861\u7684\u7b56\u7565\u3002"),(0,a.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\uff0c\u9664\u4e86windows\u7cfb\u7edf\u4e0b\uff0c\u4f7f\u7528cluster\u65f6\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u4e3around-robin\u3002\u6bd4\u5982\u521a\u624d\u7684\u670d\u52a1\u5668\uff0c\u6536\u5230\u4e868\u4e2a\u8bf7\u6c42\uff0c\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u4ea4\u7ed9\u7b2c\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u5904\u7406\uff0c\u7b2c\u4e8c\u4e2a\u8bf7\u6c42\u4ea4\u7ed9\u7b2c\u4e8c\u4e2a\u5b50\u8fdb\u7a0b..."),(0,a.kt)("p",null,"\u5728windows\u7cfb\u7edf\u4e0b\uff0c\u901a\u8fc7\u4ee5\u4e0b\u4ee3\u7801\u6765\u8bbe\u7f6e\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u4e3around-robin"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"cluster.schedulingPolicy = cluster.SCHED_RR;")),(0,a.kt)("p",null,"\u53e6\u5916\uff0cpm2\u4e5f\u81ea\u5e26cluster\uff0c\u6bd4\u5982\u53ef\u4ee5\u9760\u4ee5\u4e0b\u4ee3\u7801\u521b\u5efa8\u4e2a\u5b50\u8fdb\u7a0b\u3002"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"pm2 start app.js -i 8")),(0,a.kt)("h2",{id:"url\u6a21\u5757"},"url\u6a21\u5757"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u5f53\u8bf7\u6c42url\u4e3a http://localhost:3000/index.html?name=akara#aa\nconst url = require('url')\nlet {\n    search, // '?name=akara'\n    query, // 'name=akara'\n    pathname, // '/index.html'\n    path, // '/index.html?name=akara'\n} = url.parse(req.url)\n")),(0,a.kt)("h2",{id:"querystring\u6a21\u5757"},"querystring\u6a21\u5757"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const qs = require('querystring')\nvar str = 'foo=bar&abc=xyz&abc=123';\n\nquerystring.parse(str)\n// { foo: 'bar', abc: [ 'xyz', '123' ] }\n")),(0,a.kt)("h2",{id:"os\u6a21\u5757"},"os\u6a21\u5757"),(0,a.kt)("p",null,"\u83b7\u53d6\u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173\u4fe1\u606f\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const os = require('os')\nconst homedir = os.homedir() // \u83b7\u53d6\u7528\u6237\u76ee\u5f55\n")),(0,a.kt)("h2",{id:"event\u6a21\u5757"},"event\u6a21\u5757"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5b9e\u73b0\u539f\u7406\u89c1\u672c\u6587\u7684\u8bbe\u8ba1\u6a21\u5f0f-\u53d1\u5e03\u8ba2\u9605\u7ae0\u8282")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"var EventEmitter = require('events').EventEmitter\nvar emitter = new EventEmitter()\n\nemitter.on('ev', function () {\n\n})\n\nemitter.emit('ev')\n")),(0,a.kt)("hr",null),(0,a.kt)("p",null,"\u4ee5\u4e0a\u662fNode\u81ea\u5e26\u7684\u6838\u5fc3\u5e93\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e9b\u5e38\u7528\u7684\u7b2c\u4e09\u65b9\u5e93\u3002"))}u.isMDXComponent=!0}}]);