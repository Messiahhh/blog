
:::info

ä¸€ä¸ªç»„ä»¶ä»åˆ›å»ºåˆ°é”€æ¯ï¼Œä¸­é—´ä¼šç»å†æ— æ•°æ¬¡é‡æ–°æ¸²æŸ“ï¼ˆæ¸²æŸ“æŒ‡è°ƒç”¨å‡½æ•°ç”Ÿæˆè™šæ‹ŸDOMï¼Œé€šè¿‡Diffæ“ä½œçœŸå®DOMï¼‰ï¼Œå¤šæ¬¡å‡½æ•°è°ƒç”¨è‡ªç„¶æ„å‘³ç€ä¼šå­˜åœ¨å¤šä¸ªå‡½æ•°ä½œç”¨åŸŸã€‚

åŒæ—¶ç»„ä»¶åˆ›å»ºçš„æ—¶å€™ä¼šæœ‰ä¸€å—å…³è”çš„**çº¿æ€§å­˜å‚¨å•å…ƒ**ï¼ˆæœ¬è´¨ä¸Šæ˜¯é“¾è¡¨å­˜å‚¨`memorizedState`ï¼‰ï¼Œé”€æ¯çš„æ—¶å€™ä¼šæ¸…ç©ºã€‚é‚£ä¹ˆæ¯æ¬¡æ‰§è¡Œæ¸²æŸ“å‡½æ•°çš„æ—¶å€™ï¼Œæ ¹æ®Hookåœ¨å‡½æ•°ä¸­å‡ºç°çš„ä½ç½®ï¼Œè¿™ä¸ªHookéƒ½æœ‰æƒè®¿é—®ï¼ˆè¯»ä¸å†™ï¼‰çº¿æ€§å­˜å‚¨å•å…ƒä¸­å¯¹åº”ä½ç½®ä¸­çš„æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¼ºåˆ¶è¦æ±‚æ¯æ¬¡æ‰§è¡Œå‡½æ•°æ—¶Hookå‡ºç°çš„é¡ºåºéƒ½å¿…é¡»ä¸€è‡´ã€‚æ‰€ä»¥ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå¤šæ¬¡å‡½æ•°è°ƒç”¨æ—¶ç”Ÿæˆçš„ä½œç”¨åŸŸéƒ½å…±äº«ç€åŒä¸€å—æ•°æ®å•å…ƒã€‚

:::
## useState

ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ã€‚ 

å¦‚ä¸‹è¿°ä¾‹å­ä¸­ï¼Œ`count`å˜é‡å®é™…ä¸Šæ˜¯é€šè¿‡**è¯»å–**çº¿æ€§å­˜å‚¨å•å…ƒä¸­å¯¹åº”ä½ç½®ï¼ˆæœ¬ä¾‹ä¸ºä½ç½®0ï¼‰å¾—åˆ°çš„ï¼Œè°ƒç”¨`setCount`çš„æ—¶å€™å®é™…ä¸Šå°±æ˜¯åœ¨å¯¹åº”ä½ç½®**å†™å…¥**æ–°çš„å€¼ï¼Œå¹¶ä¸”ä¼šè§¦å‘ç»„ä»¶æ¸²æŸ“ï¼ˆå› æ­¤ç¬¬äºŒæ¬¡ç»„ä»¶æ¸²æŸ“çš„æ—¶å€™`count`èƒ½å¤Ÿæ‹¿åˆ°æ–°çš„å€¼ï¼‰

``` jsx live
function Example(props) {
    let [count, setCount] = useState(0) // åˆå§‹å€¼0
    return (
        <div>
            <div>{ count }</div>
            <button onClick={() => setCount(count + 1)}>
              ç‚¹å‡»
            </button>
        </div>
    )
}
```

`setState`çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°

``` js
setState(count => count + 1)
```

## useEffect

å½“ä¾èµ–çš„æŸä¸ªçŠ¶æ€æ”¹å˜æ—¶æ‰§è¡Œå‰¯ä½œç”¨ã€‚

è¿™æ„å‘³ç€å½“æ‰§è¡Œ`useEffect`æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æœ‰èƒ½åŠ›åˆ¤æ–­å½“å‰ä¾èµ–æ•°ç»„çš„å€¼æ˜¯å¦å’Œä¸Šä¸€æ¬¡ä½œç”¨åŸŸçš„è¯¥å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬æ˜¯åœ¨æ¯”è¾ƒä¸¤ä¸ªå‡½æ•°ä½œç”¨åŸŸçš„å€¼ï¼Œå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ—¶å€™æŠŠè¿™ä¸ªå€¼è®°å½•åœ¨**çº¿æ€§å­˜å‚¨å•å…ƒ**ä¸­ï¼Œè¿™æ ·ç¬¬äºŒæ¬¡å‡½æ•°è°ƒç”¨çš„æ—¶å€™å°±å¯ä»¥å–å€¼è¿›è¡Œæ¯”è¾ƒäº†ã€‚


``` jsx live
function App() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨`useEffect`æ¥è®¾ç½®å®šæ—¶å™¨ã€äº‹ä»¶è®¢é˜…ï¼Œä¸ºé¿å…å†…å­˜æ³„æ¼æˆ–å…¶ä»–å½±å“ï¼Œæˆ‘ä»¬éœ€è¦åœ¨`useEffect`çš„å›è°ƒä¸­è¿”å›ä¸€ä¸ªå‡½æ•°ç”¨æ¥æ¸…é™¤å‰¯ä½œç”¨ï¼Œè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æˆ–é”€æ¯å‰è°ƒç”¨ã€‚

``` javascript
useEffect(() => {
    const timer = setTimeout(() => {
      // doSomething
    }, 1000);
    // æ¸…é™¤å‰¯ä½œç”¨
    return () => {
        clearTimeout(timer)
    }
})
```

## useRef

`useRef`çš„ä½œç”¨ç±»ä¼¼`useState`ï¼Œä¹Ÿæ˜¯åœ¨çº¿æ€§å­˜å‚¨å•å…ƒä¸­è®°å½•æ•°æ®ï¼Œä½†`useState`ä¸­æ•°æ®çš„æ”¹å˜ä¼šå¼•å‘é‡æ–°æ¸²æŸ“ï¼Œå¦‚æœæˆ‘ä»¬åˆå¸Œæœ›ä¸åŒå‡½æ•°ä½œç”¨åŸŸå¯ä»¥å¼•ç”¨åˆ°åŒä¸€ä¸ªå€¼ï¼Œåˆä¸å¸Œæœ›è¿™ä¸ªå€¼çš„æ›´æ–°è§¦å‘æ¸²æŸ“ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨`useRef`


``` jsx live
function App(props) {
    const [count, setCount] = useState(0)
    // highlight-next-line
    let ref = useRef(0) // ref: MutableRefObject<number>
    return (
      <>
        <div>ref: { ref.current }</div>
        <div>count: { count }</div>
        <button onClick={() => ref.current += 1}>ref.current+1ï¼Œä½†ä¸é‡æ–°æ¸²æŸ“</button>
        <button onClick={() => setCount(count => count + 1)}>count+1ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“</button>
      </>
    )
}
```

é™¤äº†ç”¨æ¥è®°å½•å€¼ï¼Œ`useRef`è¿˜å¯ä»¥ç”¨æ¥è®°å½•`DOM`èŠ‚ç‚¹çš„å¼•ç”¨
``` tsx
function Test() {
    // highlight-next-line
    const ref = useRef<HTMLDivElement>(null!) // ref: RefObject<HTMLDivElement>
    
    return <div ref={ref} onClick={() => console.log(ref.current.innerText)}>ç‚¹å‡»</div>
}
```
:::note
å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ ¹æ®`useRef`ä¼ å€¼æ–¹å¼ä¸åŒï¼Œå…¶è¿”å›å€¼çš„ç±»å‹ä¹Ÿä¸ä¸€æ ·ã€‚
:::
``` ts 
interface MutableRefObject<T> {
    current: T;
}

interface RefObject<T> {
    readonly current: T | null;
}

``` 





## useMemo

æ ¹æ®ä¾èµ–çš„å˜é‡ç¼“å­˜è®¡ç®—çš„ç»“æœï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦åœ¨çº¿æ€§å­˜å‚¨ç©ºé—´ä¸­è®°å½•ä¾èµ–çš„å€¼å’Œè¢«ç¼“å­˜çš„ç»“æœã€‚

``` js
const revertMsg = useMemo(() => msg.split('').reverse().join(''), [msg])
```



## useCallback

æ ¹æ®ä¾èµ–çš„å˜é‡ç¼“å­˜å‡½æ•°ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦åœ¨çº¿æ€§å­˜å‚¨ç©ºé—´ä¸­è®°å½•ä¾èµ–çš„å€¼å’Œè¢«ç¼“å­˜çš„å‡½æ•°ã€‚

å¯¹äºè¿™æ ·çš„ä¸€æ®µä»£ç ï¼Œçˆ¶ç»„ä»¶å°†åŒ¿åå‡½æ•°ï¼ˆæˆ–æ™®é€šå‡½æ•°ï¼‰ä½œä¸º`props`ä¼ é€’ç»™å­ç»„ä»¶ã€‚å½“çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„åŒ¿åå‡½æ•°ï¼ˆåœ°å€ä¸åŒï¼‰ä½œä¸º`props`ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå› æ­¤ä¼š**è§¦å‘å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“**ã€‚

``` jsx
function Father () {
    const [count, setCount] = useState(0)
    return (
    	<PureChildComponent onClick={() => { setCount(1) }}/>
    )
}
```

é€šè¿‡ä½¿ç”¨`useCallback`ç¼“å­˜è¯¥å‡½æ•°ï¼Œå› ä¸ºåœ°å€ç›¸åŒæ‰€ä»¥å¯ä»¥é¿å…ä¸å¿…è¦çš„ç»„ä»¶æ¸²æŸ“ã€‚

``` jsx
function Father () {
    const [count, setCount] = useState(0)
    const cb = useCallback(() => {
       setCount(count => count + 1)
    }, [])
    return (
    	<PureChildComponent onClick={cb}/>
    )
}
```

ç†è®ºä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`useMemo`å®ç°è¯¥åŠŸèƒ½ï¼Œåªæ˜¯`useCallback`æ›´åŠ è¯­ä¹‰åŒ–

``` jsx
function Father () {
    const [count, setCount] = useState(0)
    const cb = useMemo(() => {
       return () => setCount(count => count + 1)
    }, [])
    return (
    	<PureChildComponent onClick={cb}/>
    )
}
```
:::note
`useCallback(fn, deps)` ç›¸å½“äº `useMemo(() => fn, deps)`
:::
## useContext
é€šè¿‡ä½¿ç”¨`useContext`ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ç»„ä»¶å†…éƒ¨è·å–åˆ°å¤–å±‚`<MyContext.Provider value={value}>`ä¼ é€’ä¸‹æ¥çš„å€¼ï¼Œå…å»äº†ä¸€å±‚ä¸€å±‚ä¼ `props`çš„çƒ¦æ¼ã€‚

:::caution
ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦æˆ‘ä»¬ç»„ä»¶ä½¿ç”¨äº†`useContext()`ï¼Œé‚£ä¹ˆä¸€æ—¦`Provider`ä¼ é€’çš„`value`åœ°å€å‘ç”Ÿäº†æ”¹å˜ï¼Œå°±ä¼šè§¦å‘æˆ‘ä»¬ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚
:::
``` jsx 
const MyContext = createContext(null);

function App() {
  const [count, setCount] = useState(0);

  return (
    // å½“countæ”¹å˜ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶valueæ˜¯ä¸ªåœ°å€ä¸åŒçš„æ–°å¯¹è±¡ï¼Œå¯¼è‡´ä½¿ç”¨`useContext`çš„ç»„ä»¶ä¹Ÿä¼šæ¸²æŸ“
    // highlight-start
    <MyContext.Provider value={{ 
        name: 'aka',
        age: 20
    }}>
    // highlight-end
      <button onClick={() => setCount(count => count + 1)}></button>
      <Child />
    </MyContext.Provider>
  );
}

const Child = memo(() => {
  useContext(MyContext);
  console.log('render'); 
  return <div>hello</div>;
});
```

:::info
å®é™…ä¸Šè¿™æ˜¯[è®¾è®¡æˆè¿™æ ·çš„](https://github.com/facebook/react/issues/15156#issuecomment-474590693)ï¼Œä¸è¿‡è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™æ¸²æŸ“å¤ªé¢‘ç¹ï¼Œç›®å‰æˆ‘ä»¬ä¹Ÿæœ‰ä¸€äº›[æ–¹æ³•](https://blog.axlight.com/posts/4-options-to-prevent-extra-rerenders-with-react-context/)é¿å…é‡å¤çš„æ¸²æŸ“
:::

## useReducer

åŠŸèƒ½å’Œ`useState`ä¸€æ ·ï¼Œåªæ˜¯ä¿®æ”¹æ•°æ®çš„å½¢å¼ä¸åŒ

``` jsx
function Todos() {
  const [todos, dispatch] = useReducer(todosReducer, []);

  function handleAddClick(text) {
    dispatch({ type: 'add', text });
  }

  // ...
}

function todosReducer(state, action) {
  switch (action.type) {
    case 'add':
      return [...state, {
        text: action.text,
        completed: false
      }];
    // ... other actions ...
    default:
      return state;
  }
}
```

`useReducer`çš„ç®€å•å®ç°ç‰ˆæœ¬å¦‚ä¸‹

```js
function useReducer(reducer, initialState) {
  const [state, setState] = useState(initialState);

  function dispatch(action) {
    const nextState = reducer(state, action);
    setState(nextState);
  }

  return [state, dispatch];
}
```

## useImperativeHandle

:::note
`useImperativeHandle`å¿…é¡»ä¸`forwordRef`æ­é…ä½¿ç”¨
:::
``` js
// forwardRef + useImperativeHandle
function FancyInput(props, ref) {
  const inputRef = useRef();
  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    }
  }));
  return <input ref={inputRef} />;
}
FancyInput = forwardRef(FancyInput);
```

## è‡ªå®šä¹‰Hook
ç®€å•æ¥è¯´åªè¦ä¸€ä¸ªå‡½æ•°å†…éƒ¨ç”¨åˆ°äº†Hookå°±å¯ä»¥å«åšè‡ªå®šä¹‰Hookï¼Œåªä¸è¿‡ä¸€èˆ¬ä¼šçº¦å®šå‡½æ•°åå‰ç¼€ä¸º`use`ã€‚

æˆ‘ä»¬åªéœ€è¦ä¿è¯å¯¹äºä¸€ä¸ªç»„ä»¶å¤šæ¬¡è°ƒç”¨æ—¶å†…éƒ¨Hookï¼ˆeg: `useState`ã€`useEffect`ï¼‰å‡ºç°çš„æ¬¡åºä¿æŒä¸€è‡´å³å¯ï¼Œæ‰€è°“çš„è‡ªå®šä¹‰Hookå…¶å®èµ·åˆ°çš„åªæ˜¯ä¸€ç§**ç»„åˆ**çš„åŠŸèƒ½ï¼Œç”¨äºå°†ç›¸å…³çš„é€»è¾‘æŠ½ç¦»åˆ°ä¸€ä¸ªå‡½æ•°å†…éƒ¨ã€‚


## Hooké—­åŒ…é™·é˜±

åœ¨æœ¬ç« çš„å¼€å¤´æˆ‘å·²ç»è§£é‡Šäº†ï¼Œç»„ä»¶å¤šæ¬¡æ¸²æŸ“æ„å‘³ç€å¤šæ¬¡åˆ›å»ºä½œç”¨åŸŸã€‚è™½ç„¶æˆ‘ä»¬åœ¨æœ€æ–°çš„ä½œç”¨åŸŸå‘ç°å€¼å·²ç»æ˜¯æœ€æ–°çš„ï¼Œä½†ä¸€ä¸ªæ—§çš„ä½œç”¨åŸŸä¸­è°ƒç”¨çš„å‡½æ•°è‡ªç„¶åªèƒ½æ‹¿åˆ°æ—§ä½œç”¨åŸŸä¸­çš„æ—§å€¼ã€‚

### ä¾‹å­1 ğŸŒ°
``` jsx live 
// æµ‹è¯•ä»£ç 1
function Test1() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        setTimeout(() => {
            console.log(count)
        }, 3000)
    }, [])

    return (
        <div>
            <div>{count}</div>
            <button onClick={() => setCount(10)}>é‡æ–°æ¸²æŸ“</button>
        </div>
    )
}
```
æœ¬ä¾‹æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸçš„`count`å€¼ä¸º0ï¼ŒåŒæ—¶æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼›å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ä¼šæŠŠç»„ä»¶çš„`Fiber Node`å†…çš„`memorizedState`ä¸­å¯¹åº”ä½ç½®çš„çŠ¶æ€è®¾ç½®ä¸º`10`ï¼Œå¹¶è§¦å‘ç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼Œåœ¨ç¬¬äºŒä¸ªå‡½æ•°ä½œç”¨åŸŸçš„æ—¶å€™`count`å€¼ä¸º10ã€‚

ç„¶è€Œå½“ä¸‰ç§’åç¬¬ä¸€ä¸ªä½œç”¨åŸŸçš„å‡½æ•°æ‰§è¡Œï¼Œè¾“å‡ºäº†ç¬¬ä¸€ä¸ªä½œç”¨åŸŸçš„`count`å€¼ï¼Œç»“æœä¸º0ã€‚

:::info é€šç”¨è§£å†³åŠæ³•
``` jsx
useEffect(() => {
    const timer = setTimeout(() => {
        console.log(count)
    }, 3000)

    return () => clearTimeout(timer)
}, [count])
```
:::


### ä¾‹å­2 ğŸŒ°
``` jsx live
// æµ‹è¯•ä»£ç 2
function Test2() {
    const [count, setCount] = useState(0)
    const fn = useCallback(() => {
      alert(count)
    }, []) // ç©ºæ•°ç»„
    return (
        <div>
            <div>{count}</div>
            <button onClick={() => setCount(100)}>é‡æ–°æ¸²æŸ“</button>
            <button onClick={fn}>è¾“å‡ºç»“æœ</button> 
        </div>
    )
}
``` 

æœ¬ä¾‹ç±»ä¼¼ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸçš„`count`ä¸º0ï¼ŒåŒæ—¶æˆ‘ä»¬æŠŠ`useCallback`çš„å‚æ•°å›è°ƒç¼“å­˜è¿›`memorizedState`å½“ä¸­ï¼›å½“ç»„ä»¶ç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œ`useCallback`å› ä¸ºä¾èµ–æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒæŠŠç¼“å­˜çš„ç¬¬ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­çš„å›è°ƒå‡½æ•°çš„åœ°å€ä¼ ç»™äº†ç¬¬äºŒä¸ªå‡½æ•°ä½œç”¨åŸŸçš„`fn`ï¼Œå› æ­¤ç‚¹å‡»è¾“å‡ºæŒ‰é’®çš„æ—¶å€™ç›¸å½“äºè°ƒç”¨äº†ç¬¬ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸçš„å›è°ƒï¼Œè‡ªç„¶è¾“å‡ºçš„æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸçš„`count`å€¼ï¼Œç»“æœä¸º0ã€‚

:::info é€šç”¨è§£å†³åŠæ³•
``` jsx
const fn = useCallback(() => {
    console.log(count)
}, [count]) 
```
è¿™æ ·å½“ä¾èµ–çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•°å¹¶ç¼“å­˜è¿›`memorizedState`
:::

`useCallback`æœ‰ä¸¤ç‚¹å¥½å¤„ï¼Œä¸€æ˜¯å‡å°‘ä¸å¿…è¦çš„å‡½æ•°åˆ›å»ºå¼€é”€ï¼ŒäºŒæ˜¯åœ°å€çš„ä¸å˜ä½¿å¾—ä½œä¸º`props`ä¼ é€’ç»™å­ç»„ä»¶æ—¶ä¹Ÿå¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ï¼ˆç¬¬äºŒç‚¹å¯¹æ€§èƒ½çš„å½±å“æ›´å¤§ï¼‰ã€‚ä½†å¯¹äºä¸Šè¿°è§£å†³æ–¹æ¡ˆï¼Œä¸€æ—¦`count`å˜åŒ–éå¸¸é¢‘ç¹ï¼Œæˆ‘ä»¬çš„å‡½æ•°è¿˜æ˜¯å¾—ä¸æ–­é‡æ–°åˆ›å»ºï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›èƒ½é¿å…è¿™ç§æƒ…å†µã€‚

å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`useRef`æ¥å®ç°æƒ³è¦çš„æ•ˆæœï¼Œå…¶åŸç†æ˜¯åœ¨æœ€æ–°çš„å‡½æ•°ä½œç”¨åŸŸä¸­æŠŠ`count`çš„å€¼èµ‹å€¼ç»™`ref.current`ï¼Œå› æ­¤åœ¨æ—§çš„ä½œç”¨åŸŸä¸­å¯ä»¥é€šè¿‡`ref.current`å–åˆ°è¯¥å€¼ã€‚

``` jsx live
function App() {
  const [count, setCount] = useState(0);
  const ref = useRef(count);
  ref.current = count;

  const fn = useCallback(() => {
    console.log(ref.current);
  }, [ref]); // è¿™é‡Œçš„ä¾èµ–åŠ ä¸ä¸åŠ å…¶å®ä¸å½±å“ï¼Œå› ä¸ºrefçš„åœ°å€æ˜¯ä¸å˜çš„

  return (
    <>
      {count}
      <button onClick={() => setCount(100)}>ç‚¹æˆ‘</button>
      <button onClick={fn}>è¾“å‡º</button>
    </>
  );
}
```



è€Œåœ¨`ahooks`ä¹Ÿæä¾›äº†ä¸€ä¸ª`usePersistFn`æä¾›ç»™æˆ‘ä»¬ä½¿ç”¨ã€‚

``` js
export type noop = (...args: any[]) => any;

function usePersistFn<T extends noop>(fn: T) {
  const ref = useRef<any>(() => {
    throw new Error('Cannot call function while rendering.');
  });

  ref.current = fn;

  const persistFn = useCallback(((...args) => ref.current(...args)) as T, [ref]);

  return persistFn;
}

// ä½¿ç”¨
const [count, setCount] = useState(0);
const showCountPersistFn = usePersistFn(() => {
    alert(`Current count is ${count}`);
});
```

æœ¬è´¨æ˜¯`ref`çš„`current`ä¸æ–­è¢«èµ‹äºˆæ–°çš„å‡½æ•°`fn`ï¼Œæ‰€ä»¥å¯ä»¥æ‹¿åˆ°æ–°çš„å‡½æ•°ä½œç”¨åŸŸä¸‹çš„å€¼ã€‚



å‚è€ƒé“¾æ¥ï¼š

[React HookåŸç†](https://github.com/brickspert/blog/issues/26)

[React useEffectçš„é™·é˜±](https://zhuanlan.zhihu.com/p/84697185)


